import React, { useEffect, useState } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import Title from './Title';
import axios from 'axios';
import { Button, Grid } from '@mui/material';

const tempData = {
  "2024-05-13 19:55:00": {
    "1. open": "167.5600",
    "2. high": "167.6400",
    "3. low": "167.5500",
    "4. close": "167.6400",
    "5. volume": "133"
  },
  "2024-05-13 19:45:00": {
    "1. open": "167.5900",
    "2. high": "167.6400",
    "3. low": "167.5900",
    "4. close": "167.6400",
    "5. volume": "20"
  },
  "2024-05-13 19:30:00": {
    "1. open": "167.3500",
    "2. high": "167.5200",
    "3. low": "167.3500",
    "4. close": "167.5200",
    "5. volume": "5"
  },
  "2024-05-13 19:25:00": {
    "1. open": "167.3500",
    "2. high": "167.3500",
    "3. low": "167.3500",
    "4. close": "167.3500",
    "5. volume": "5"
  },
  "2024-05-13 19:20:00": {
    "1. open": "167.3500",
    "2. high": "167.3500",
    "3. low": "167.3500",
    "4. close": "167.3500",
    "5. volume": "1"
  },
  "2024-05-13 19:00:00": {
    "1. open": "167.5600",
    "2. high": "167.6400",
    "3. low": "167.5200",
    "4. close": "167.6400",
    "5. volume": "473192"
  },
  "2024-05-13 18:50:00": {
    "1. open": "167.5500",
    "2. high": "167.5600",
    "3. low": "167.5400",
    "4. close": "167.5400",
    "5. volume": "4"
  },
  "2024-05-13 18:45:00": {
    "1. open": "167.3500",
    "2. high": "167.5200",
    "3. low": "167.3500",
    "4. close": "167.5200",
    "5. volume": "10"
  },
  "2024-05-13 18:40:00": {
    "1. open": "167.6400",
    "2. high": "167.6400",
    "3. low": "167.6400",
    "4. close": "167.6400",
    "5. volume": "85"
  },
  "2024-05-13 18:35:00": {
    "1. open": "167.6400",
    "2. high": "167.6400",
    "3. low": "167.6400",
    "4. close": "167.6400",
    "5. volume": "4"
  },
  "2024-05-13 18:30:00": {
    "1. open": "167.5600",
    "2. high": "167.5600",
    "3. low": "167.5200",
    "4. close": "167.5200",
    "5. volume": "473034"
  },
  "2024-05-13 18:20:00": {
    "1. open": "167.3500",
    "2. high": "167.3500",
    "3. low": "167.3500",
    "4. close": "167.3500",
    "5. volume": "10"
  },
  "2024-05-13 18:15:00": {
    "1. open": "167.5200",
    "2. high": "167.5200",
    "3. low": "167.5200",
    "4. close": "167.5200",
    "5. volume": "1"
  },
  "2024-05-13 18:00:00": {
    "1. open": "167.6400",
    "2. high": "167.6400",
    "3. low": "167.6400",
    "4. close": "167.6400",
    "5. volume": "1"
  },
  "2024-05-13 17:55:00": {
    "1. open": "167.6400",
    "2. high": "167.6400",
    "3. low": "167.6400",
    "4. close": "167.6400",
    "5. volume": "3"
  },
  "2024-05-13 17:45:00": {
    "1. open": "167.5500",
    "2. high": "167.6400",
    "3. low": "167.5500",
    "4. close": "167.6400",
    "5. volume": "100"
  },
  "2024-05-13 17:40:00": {
    "1. open": "167.6400",
    "2. high": "167.6400",
    "3. low": "167.5500",
    "4. close": "167.5500",
    "5. volume": "3"
  },
  "2024-05-13 17:35:00": {
    "1. open": "167.6400",
    "2. high": "167.6400",
    "3. low": "167.6400",
    "4. close": "167.6400",
    "5. volume": "2"
  },
  "2024-05-13 17:30:00": {
    "1. open": "167.5200",
    "2. high": "167.5200",
    "3. low": "167.5200",
    "4. close": "167.5200",
    "5. volume": "7"
  },
  "2024-05-13 17:25:00": {
    "1. open": "167.5200",
    "2. high": "167.5200",
    "3. low": "167.5200",
    "4. close": "167.5200",
    "5. volume": "90"
  },
  "2024-05-13 17:20:00": {
    "1. open": "167.5300",
    "2. high": "167.5300",
    "3. low": "167.5300",
    "4. close": "167.5300",
    "5. volume": "4"
  },
  "2024-05-13 17:10:00": {
    "1. open": "167.5400",
    "2. high": "167.5500",
    "3. low": "167.5400",
    "4. close": "167.5500",
    "5. volume": "34"
  },
  "2024-05-13 17:00:00": {
    "1. open": "166.9000",
    "2. high": "167.5500",
    "3. low": "166.9000",
    "4. close": "167.5500",
    "5. volume": "25"
  },
  "2024-05-13 16:55:00": {
    "1. open": "166.9000",
    "2. high": "166.9000",
    "3. low": "166.9000",
    "4. close": "166.9000",
    "5. volume": "2"
  },
  "2024-05-13 16:50:00": {
    "1. open": "167.5000",
    "2. high": "167.5000",
    "3. low": "167.4900",
    "4. close": "167.4900",
    "5. volume": "6"
  },
  "2024-05-13 16:45:00": {
    "1. open": "167.5400",
    "2. high": "167.6400",
    "3. low": "167.4000",
    "4. close": "167.4000",
    "5. volume": "10"
  },
  "2024-05-13 16:40:00": {
    "1. open": "166.8000",
    "2. high": "166.8000",
    "3. low": "166.8000",
    "4. close": "166.8000",
    "5. volume": "2"
  },
  "2024-05-13 16:35:00": {
    "1. open": "167.5600",
    "2. high": "167.5600",
    "3. low": "166.8000",
    "4. close": "166.8000",
    "5. volume": "7"
  },
  "2024-05-13 16:30:00": {
    "1. open": "167.5600",
    "2. high": "167.5600",
    "3. low": "167.5600",
    "4. close": "167.5600",
    "5. volume": "20"
  },
  "2024-05-13 16:25:00": {
    "1. open": "167.5400",
    "2. high": "167.5400",
    "3. low": "167.5400",
    "4. close": "167.5400",
    "5. volume": "1"
  },
  "2024-05-13 16:20:00": {
    "1. open": "167.5600",
    "2. high": "167.5600",
    "3. low": "167.5600",
    "4. close": "167.5600",
    "5. volume": "45"
  },
  "2024-05-13 16:15:00": {
    "1. open": "167.5600",
    "2. high": "167.5600",
    "3. low": "166.8000",
    "4. close": "166.8000",
    "5. volume": "191"
  },
  "2024-05-13 16:10:00": {
    "1. open": "167.5600",
    "2. high": "167.5600",
    "3. low": "167.5600",
    "4. close": "167.5600",
    "5. volume": "473011"
  },
  "2024-05-13 16:05:00": {
    "1. open": "167.5600",
    "2. high": "167.5700",
    "3. low": "167.5600",
    "4. close": "167.5600",
    "5. volume": "1888"
  },
  "2024-05-13 16:00:00": {
    "1. open": "167.5200",
    "2. high": "167.5600",
    "3. low": "166.8000",
    "4. close": "167.5600",
    "5. volume": "1032524"
  },
  "2024-05-13 15:55:00": {
    "1. open": "167.5500",
    "2. high": "167.6000",
    "3. low": "167.3500",
    "4. close": "167.5200",
    "5. volume": "198988"
  },
  "2024-05-13 15:50:00": {
    "1. open": "167.4500",
    "2. high": "167.5500",
    "3. low": "167.3800",
    "4. close": "167.5400",
    "5. volume": "58576"
  },
  "2024-05-13 15:45:00": {
    "1. open": "167.4750",
    "2. high": "167.4800",
    "3. low": "167.3250",
    "4. close": "167.4290",
    "5. volume": "46554"
  },
  "2024-05-13 15:40:00": {
    "1. open": "167.4050",
    "2. high": "167.4900",
    "3. low": "167.3600",
    "4. close": "167.4900",
    "5. volume": "22784"
  },
  "2024-05-13 15:35:00": {
    "1. open": "167.4500",
    "2. high": "167.5000",
    "3. low": "167.3800",
    "4. close": "167.3900",
    "5. volume": "22385"
  },
  "2024-05-13 15:30:00": {
    "1. open": "167.3500",
    "2. high": "167.4700",
    "3. low": "167.3100",
    "4. close": "167.4650",
    "5. volume": "16310"
  },
  "2024-05-13 15:25:00": {
    "1. open": "167.3300",
    "2. high": "167.3700",
    "3. low": "167.2600",
    "4. close": "167.3400",
    "5. volume": "18093"
  },
  "2024-05-13 15:20:00": {
    "1. open": "167.4700",
    "2. high": "167.4700",
    "3. low": "167.3200",
    "4. close": "167.3200",
    "5. volume": "21357"
  },
  "2024-05-13 15:15:00": {
    "1. open": "167.4100",
    "2. high": "167.4600",
    "3. low": "167.3800",
    "4. close": "167.4500",
    "5. volume": "17090"
  },
  "2024-05-13 15:10:00": {
    "1. open": "167.3500",
    "2. high": "167.4440",
    "3. low": "167.3010",
    "4. close": "167.3700",
    "5. volume": "18173"
  },
  "2024-05-13 15:05:00": {
    "1. open": "167.3170",
    "2. high": "167.4100",
    "3. low": "167.2900",
    "4. close": "167.3700",
    "5. volume": "16565"
  },
  "2024-05-13 15:00:00": {
    "1. open": "167.3850",
    "2. high": "167.4050",
    "3. low": "167.3300",
    "4. close": "167.3520",
    "5. volume": "8739"
  },
  "2024-05-13 14:55:00": {
    "1. open": "167.2300",
    "2. high": "167.4130",
    "3. low": "167.2300",
    "4. close": "167.3850",
    "5. volume": "21188"
  },
  "2024-05-13 14:50:00": {
    "1. open": "167.2100",
    "2. high": "167.2700",
    "3. low": "167.1700",
    "4. close": "167.2500",
    "5. volume": "15173"
  },
  "2024-05-13 14:45:00": {
    "1. open": "167.3100",
    "2. high": "167.3500",
    "3. low": "167.1800",
    "4. close": "167.2100",
    "5. volume": "30014"
  },
  "2024-05-13 14:40:00": {
    "1. open": "167.3100",
    "2. high": "167.5200",
    "3. low": "167.2400",
    "4. close": "167.2750",
    "5. volume": "18253"
  },
  "2024-05-13 14:35:00": {
    "1. open": "167.3500",
    "2. high": "167.3600",
    "3. low": "167.3100",
    "4. close": "167.3400",
    "5. volume": "15045"
  },
  "2024-05-13 14:30:00": {
    "1. open": "167.2450",
    "2. high": "167.3800",
    "3. low": "167.2400",
    "4. close": "167.3800",
    "5. volume": "17012"
  },
  "2024-05-13 14:25:00": {
    "1. open": "167.2150",
    "2. high": "167.2700",
    "3. low": "167.0600",
    "4. close": "167.2700",
    "5. volume": "21565"
  },
  "2024-05-13 14:20:00": {
    "1. open": "167.1200",
    "2. high": "167.2600",
    "3. low": "167.1200",
    "4. close": "167.2290",
    "5. volume": "18353"
  },
  "2024-05-13 14:15:00": {
    "1. open": "167.2300",
    "2. high": "167.2460",
    "3. low": "167.1150",
    "4. close": "167.1150",
    "5. volume": "13642"
  },
  "2024-05-13 14:10:00": {
    "1. open": "167.2000",
    "2. high": "167.2500",
    "3. low": "167.1800",
    "4. close": "167.2000",
    "5. volume": "10108"
  },
  "2024-05-13 14:05:00": {
    "1. open": "167.1600",
    "2. high": "167.2300",
    "3. low": "167.1430",
    "4. close": "167.2000",
    "5. volume": "18423"
  },
  "2024-05-13 14:00:00": {
    "1. open": "167.2300",
    "2. high": "167.3000",
    "3. low": "167.1400",
    "4. close": "167.1900",
    "5. volume": "13895"
  },
  "2024-05-13 13:55:00": {
    "1. open": "167.2300",
    "2. high": "167.2500",
    "3. low": "167.1800",
    "4. close": "167.2500",
    "5. volume": "13377"
  },
  "2024-05-13 13:50:00": {
    "1. open": "166.9850",
    "2. high": "167.2600",
    "3. low": "166.9500",
    "4. close": "167.2100",
    "5. volume": "24749"
  },
  "2024-05-13 13:45:00": {
    "1. open": "167.1100",
    "2. high": "167.1300",
    "3. low": "166.9700",
    "4. close": "166.9700",
    "5. volume": "14431"
  },
  "2024-05-13 13:40:00": {
    "1. open": "167.0100",
    "2. high": "167.0940",
    "3. low": "167.0000",
    "4. close": "167.0800",
    "5. volume": "13596"
  },
  "2024-05-13 13:35:00": {
    "1. open": "167.0900",
    "2. high": "167.1200",
    "3. low": "167.0000",
    "4. close": "167.0000",
    "5. volume": "6544"
  },
  "2024-05-13 13:30:00": {
    "1. open": "167.1100",
    "2. high": "167.1400",
    "3. low": "167.0800",
    "4. close": "167.1100",
    "5. volume": "9049"
  },
  "2024-05-13 13:25:00": {
    "1. open": "166.9900",
    "2. high": "167.1100",
    "3. low": "166.9900",
    "4. close": "167.0980",
    "5. volume": "6051"
  },
  "2024-05-13 13:20:00": {
    "1. open": "167.0800",
    "2. high": "167.1400",
    "3. low": "166.9800",
    "4. close": "167.0050",
    "5. volume": "12751"
  },
  "2024-05-13 13:15:00": {
    "1. open": "166.9500",
    "2. high": "167.1000",
    "3. low": "166.9500",
    "4. close": "167.1000",
    "5. volume": "8120"
  },
  "2024-05-13 13:10:00": {
    "1. open": "166.8650",
    "2. high": "167.0000",
    "3. low": "166.7600",
    "4. close": "166.9650",
    "5. volume": "16025"
  },
  "2024-05-13 13:05:00": {
    "1. open": "167.0150",
    "2. high": "167.0150",
    "3. low": "166.8100",
    "4. close": "166.8650",
    "5. volume": "14091"
  },
  "2024-05-13 13:00:00": {
    "1. open": "167.1200",
    "2. high": "167.1200",
    "3. low": "166.9810",
    "4. close": "167.0100",
    "5. volume": "13944"
  },
  "2024-05-13 12:55:00": {
    "1. open": "167.2350",
    "2. high": "167.2700",
    "3. low": "167.1300",
    "4. close": "167.1400",
    "5. volume": "12541"
  },
  "2024-05-13 12:50:00": {
    "1. open": "167.3200",
    "2. high": "167.3200",
    "3. low": "167.2100",
    "4. close": "167.2410",
    "5. volume": "12553"
  },
  "2024-05-13 12:45:00": {
    "1. open": "167.2900",
    "2. high": "167.3600",
    "3. low": "167.2600",
    "4. close": "167.3200",
    "5. volume": "9773"
  },
  "2024-05-13 12:40:00": {
    "1. open": "167.3620",
    "2. high": "167.3900",
    "3. low": "167.2250",
    "4. close": "167.2900",
    "5. volume": "16564"
  },
  "2024-05-13 12:35:00": {
    "1. open": "167.3470",
    "2. high": "167.3900",
    "3. low": "167.2700",
    "4. close": "167.3400",
    "5. volume": "12576"
  },
  "2024-05-13 12:30:00": {
    "1. open": "167.3500",
    "2. high": "167.3600",
    "3. low": "167.2900",
    "4. close": "167.3400",
    "5. volume": "14423"
  },
  "2024-05-13 12:25:00": {
    "1. open": "167.2900",
    "2. high": "167.4150",
    "3. low": "167.2500",
    "4. close": "167.3500",
    "5. volume": "35568"
  },
  "2024-05-13 12:20:00": {
    "1. open": "167.4800",
    "2. high": "167.4810",
    "3. low": "167.1600",
    "4. close": "167.2650",
    "5. volume": "65176"
  },
  "2024-05-13 12:15:00": {
    "1. open": "167.4000",
    "2. high": "167.5100",
    "3. low": "167.3610",
    "4. close": "167.5100",
    "5. volume": "13511"
  },
  "2024-05-13 12:10:00": {
    "1. open": "167.5100",
    "2. high": "167.5400",
    "3. low": "167.3800",
    "4. close": "167.3800",
    "5. volume": "13933"
  },
  "2024-05-13 12:05:00": {
    "1. open": "167.4600",
    "2. high": "167.5400",
    "3. low": "167.4600",
    "4. close": "167.5100",
    "5. volume": "7262"
  },
  "2024-05-13 12:00:00": {
    "1. open": "167.3800",
    "2. high": "167.5300",
    "3. low": "167.3600",
    "4. close": "167.5050",
    "5. volume": "24985"
  },
  "2024-05-13 11:55:00": {
    "1. open": "167.3800",
    "2. high": "167.4400",
    "3. low": "167.3400",
    "4. close": "167.4000",
    "5. volume": "38667"
  },
  "2024-05-13 11:50:00": {
    "1. open": "167.3250",
    "2. high": "167.3900",
    "3. low": "167.3000",
    "4. close": "167.3900",
    "5. volume": "14127"
  },
  "2024-05-13 11:45:00": {
    "1. open": "167.4140",
    "2. high": "167.4500",
    "3. low": "167.3100",
    "4. close": "167.3100",
    "5. volume": "12944"
  },
  "2024-05-13 11:40:00": {
    "1. open": "167.4250",
    "2. high": "167.4650",
    "3. low": "167.3400",
    "4. close": "167.4050",
    "5. volume": "15307"
  },
  "2024-05-13 11:35:00": {
    "1. open": "167.4650",
    "2. high": "167.4900",
    "3. low": "167.3700",
    "4. close": "167.4250",
    "5. volume": "25170"
  },
  "2024-05-13 11:30:00": {
    "1. open": "167.3000",
    "2. high": "167.4900",
    "3. low": "167.2150",
    "4. close": "167.4700",
    "5. volume": "27865"
  },
  "2024-05-13 11:25:00": {
    "1. open": "167.4900",
    "2. high": "167.4900",
    "3. low": "167.2900",
    "4. close": "167.3600",
    "5. volume": "35446"
  },
  "2024-05-13 11:20:00": {
    "1. open": "167.6600",
    "2. high": "167.6700",
    "3. low": "167.5000",
    "4. close": "167.5150",
    "5. volume": "24331"
  },
  "2024-05-13 11:15:00": {
    "1. open": "167.5400",
    "2. high": "167.6900",
    "3. low": "167.5350",
    "4. close": "167.6600",
    "5. volume": "14944"
  },
  "2024-05-13 11:10:00": {
    "1. open": "167.5300",
    "2. high": "167.6200",
    "3. low": "167.5100",
    "4. close": "167.5300",
    "5. volume": "21377"
  },
  "2024-05-13 11:05:00": {
    "1. open": "167.4500",
    "2. high": "167.5750",
    "3. low": "167.3800",
    "4. close": "167.5200",
    "5. volume": "14283"
  },
  "2024-05-13 11:00:00": {
    "1. open": "167.5050",
    "2. high": "167.5400",
    "3. low": "167.4100",
    "4. close": "167.4700",
    "5. volume": "12947"
  },
  "2024-05-13 10:55:00": {
    "1. open": "167.4100",
    "2. high": "167.5300",
    "3. low": "167.3400",
    "4. close": "167.4900",
    "5. volume": "19775"
  },
  "2024-05-13 10:50:00": {
    "1. open": "167.5500",
    "2. high": "167.5500",
    "3. low": "167.4120",
    "4. close": "167.4300",
    "5. volume": "12604"
  },
  "2024-05-13 10:45:00": {
    "1. open": "167.6500",
    "2. high": "167.6700",
    "3. low": "167.5000",
    "4. close": "167.5500",
    "5. volume": "17114"
  },
  "2024-05-13 10:40:00": {
    "1. open": "167.4900",
    "2. high": "167.6700",
    "3. low": "167.3700",
    "4. close": "167.6600",
    "5. volume": "41693"
  },
  "2024-05-13 10:35:00": {
    "1. open": "167.5100",
    "2. high": "167.6000",
    "3. low": "167.4500",
    "4. close": "167.4900",
    "5. volume": "27467"
  }
}

const intervals = [
  { label: '1 min', value: '1min' },
  { label: '5 min', value: '5min' },
  { label: '15 min', value: '15min' },
  { label: '30 min', value: '30min' },
  { label: '60 min', value: '60min' }
];

export default function Chart({ symbol }) {
  const [chartData, setChartData] = useState([]);
  const [selectedInterval, setSelectedInterval] = useState('5min');
  useEffect(() => {
    const fetchData = async () => {
      if (symbol === "") {
        return;
      }

      // const key = "N1Q5R8UFQVH2VL4P";
      // const response = await axios.get(`https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${key}`);
      // console.log('Response',response);
      
      //const timeSeriesData = response.data["Time Series (5min)"];
        const timeSeriesData = tempData;
        const formattedData = Object.keys(timeSeriesData).map(timestamp => ({
          timestamp: new Date(timestamp),
          open: Math.round(parseFloat(timeSeriesData[timestamp]["1. open"])),
          high: Math.round(parseFloat(timeSeriesData[timestamp]["2. high"])),
          low: Math.round(parseFloat(timeSeriesData[timestamp]["3. low"])),
          close: Math.round(parseFloat(timeSeriesData[timestamp]["4. close"])),
          volume: parseInt(timeSeriesData[timestamp]["5. volume"])
        })).slice(-10);

      console.log('formattedData', formattedData);
      setChartData(formattedData);
    };
    fetchData();
  }, [symbol,selectedInterval]);

  const handleIntervalChange = (interval) => {
    setSelectedInterval(interval);
  };

  return (
    <React.Fragment>
      <Title>{symbol} </Title>
      <Grid container justifyContent="center" alignItems="center" marginBottom="1vh" spacing={1}>
      {intervals.map(({ label, value }) => (
        <Grid item key={value}>
          <Button
            variant={selectedInterval === value ? 'contained' : 'outlined'}
            onClick={() => handleIntervalChange(value)}
          >
            {label}
          </Button>
        </Grid>
      ))}
    </Grid>
      <div style={{ width: '100%', flexGrow: 1, overflow: 'hidden' }}>
      <ResponsiveContainer width="100%" height={280}>
  <LineChart data={chartData}>
    <CartesianGrid strokeDasharray="3 3" />
    <YAxis />
    <Tooltip />
    <Legend />
    <Line type="monotone" dataKey="open" stroke="#8884d8" />
    <Line type="monotone" dataKey="close" stroke="#82ca9d" />
  </LineChart>
</ResponsiveContainer>

      </div>
    </React.Fragment>
  );
}
